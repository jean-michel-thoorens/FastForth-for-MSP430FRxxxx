
; param1 = this macro filename
; param2 = pathname of the bat file
; param3 = /C = default COM saved in TERATERM.INI with all its parameters.

timeout=0                   ; 0 s
mtimeout=100                 ; + 100 ms = 100 ms
noname = '\'
connect  param3

; blanks are added to pass LPMx wake up time...
sendln '     $0A BASE ! ECHO STOP'  


; first input box to define file to be read
inputbox 'select SD_CARD file to be read:' 'SD_CARD file' '\'

strcompare inputstr noname
if result=0 then
goto end
endif

fileorg = inputstr
namedst = inputstr

strremove namedst 1 1
dirdst = param2   ; disdst = path of bat file
makepath filedst dirdst namedst ; filedst = pathname of file selected in windows 2 


; 2th input box to define destination file with param1 path
inputbox 'select destination file:' 'destination file' filedst

filecreate filehandle inputstr

;setsync 1                   ; enter synchronous mode

; send to FastForth the command TERM2SD" \file.ext"...
; ...with optionnal path added in first inputbox
sendln 'SD2TERM" ' fileorg '"'      

recvln      ; keep sendln 'SD2TERM" ' fileorg '"'
recvln      ; keep FastForth response

:start

recvln                    ; receive one line

if result=0 then          ; case of timeout
    fileclose filehandle
    goto end
endif

filewriteln filehandle inputstr ; write it to output file

send #17                  ; send XON

goto start

:end

;setsync 0                ; enter asynchronous mode

showtt 1

closett
end